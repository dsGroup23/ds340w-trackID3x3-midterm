dataset:
  dataset_path: ${data_dir}
  nvid: -1
  nframes: -1
  eval_set: val
  vids_dict:
    train: []
    val: []
    test: []
  track_eval:
    dataset_class: MotChallenge2DBox
    BENCHMARK: MotChallenge2DBox
    GT_FOLDER: eval/gt
    GT_LOC_FORMAT: '{gt_folder}/{seq}.txt'
    TRACKERS_FOLDER: eval/pred
    TRACKER_SUB_FOLDER: ''
    OUTPUT_FOLDER: eval/results
    OUTPUT_SUB_FOLDER: ''
    SPLIT_TO_EVAL: ${dataset.eval_set}
    PRINT_CONFIG: false
    DO_PREPROC: false
  _target_: tracklab.wrappers.dataset.ExternalVideo
  video_path: /home/k_yamada/workspace6/TrackID3x3/videos/Indoor/raw/basket_S2T1_pre.mp4
eval:
  _target_: tracklab.wrappers.TrackEvalEvaluator
  show_progressbar: true
  eval_set: ${dataset.eval_set}
  dataset_path: ${dataset.dataset_path}
  cfg:
    save_gt: true
    bbox_column_for_eval: bbox_ltwh
    metrics:
    - CLEAR
    - HOTA
    - Identity
    eval:
      USE_PARALLEL: true
      NUM_PARALLEL_CORES: ${num_cores}
      BREAK_ON_ERROR: false
      PRINT_RESULTS: true
      PRINT_ONLY_COMBINED: true
      PRINT_CONFIG: false
      TIME_PROGRESS: false
      DISPLAY_LESS_PROGRESS: false
      OUTPUT_SUMMARY: true
      OUTPUT_EMPTY_CLASSES: false
      OUTPUT_DETAILED: true
      PLOT_CURVES: true
    dataset: ${dataset.track_eval}
engine:
  _target_: tracklab.engine.OfflineTrackingEngine
  num_workers: ${num_cores}
  callbacks:
    progress:
      _target_: tracklab.callbacks.Progressbar
      use_rich: ${use_rich}
    vis: ${visualization}
visualization:
  colors:
    bbox:
      no_id: null
      prediction: track_id
      ground_truth:
      - 0
      - 255
      - 0
    text:
      no_id: null
      prediction: track_id
      ground_truth:
      - 0
      - 255
      - 0
    keypoint:
      no_id: null
      prediction: track_id
      ground_truth:
      - 0
      - 255
      - 0
    default:
      no_id: null
      prediction: track_id
      ground_truth: null
    'N': 10
  _target_: tracklab.visualization.VisualizationEngine
  save_videos: true
  visualizers:
    detections:
      _target_: tracklab.visualization.DefaultDetectionVisualizer
    keypoints:
      _target_: tracklab.visualization.DefaultKeypointsVisualizer
modules:
  bbox_detector:
    _target_: cameltrack.wrappers.bbox_detector.yolo_x_api.YOLOXBoTSORT
    batch_size: 1
    exp_file: /home/k_yamada/workspace6/TrackID3x3/BoT-SORT/yolox/exps/example/mot/yolox_x_mix_det.py
    ckpt_path: /home/k_yamada/workspace6/TrackID3x3/BoT-SORT/pretrained/bytetrack_x_mot17.pth.tar
    fuse: false
    trt_file: null
  pose_estimator:
    _target_: tracklab.wrappers.pose_estimator.topdown_mmpose_api.TopDownMMPose
    config_name: td-hm_hrnet-w32_8xb64-20e_posetrack18-256x192
    path_to_checkpoint: ${model_dir}/mmpose/${.config_name}.pth
    vis_kp_threshold: 0.1
    batch_size: 2
  reid:
    dataset:
      name: PoseTrack21
      nickname: pt21
      fig_size:
      - 384
      - 128
      mask_size:
      - 64
      - 32
      max_crop_size:
      - 256
      - 128
      masks_mode: pose_on_img_crops
      enable_human_parsing_labels: true
      eval_metric: mot_intra_video
      multi_video_queries_only: false
      columns: []
      sam_checkpoint: ''
      enable_sam: false
      train:
        set_name: train
        min_vis: 0.3
        min_h: 10
        min_w: 10
        min_samples_per_id: 4
        max_samples_per_id: 20
        max_total_ids: 1000
      test:
        set_name: val
        min_vis: 0.0
        min_h: 0
        min_w: 0
        min_samples_per_id: 4
        max_samples_per_id: 10
        max_total_ids: -1
        ratio_query_per_id: 0.2
    _target_: tracklab.wrappers.reid.kpreid_api.KPReId
    training_enabled: false
    batch_size: 2
    save_path: reid
    use_keypoints_visibility_scores_for_reid: false
    cfg:
      model:
        load_weights: ${model_dir}/reid/kpr_dancetrack_sportsmot_posetrack21_occludedduke_market_split0.pth.tar
        pretrained: false
        discard_test_params: false
        save_model_flag: false
        kpr:
          dim_reduce_output: 512
          keypoints:
            enabled: false
            prompt_masks: keypoints_gaussian
            prompt_preprocess: cck6
          masks:
            dir: ''
            preprocess: five_v
        transreid:
          sie_camera: false
        promptable_trans:
          masks_prompting: false
      project:
        name: ''
        experiment_name: ''
        notes: ''
        tags: []
        job_id: ''
        logger:
          use_wandb: false
      data:
        save_dir: ''
        sources:
        - market1501
        targets:
        - market1501
  track:
    _target_: cameltrack.CAMELTrack
    training_enabled: false
    checkpoint_path: camel_bbox_app_kps_sportsmot.ckpt
    override_camel_cfg: {}
    min_det_conf: 0.4
    min_init_det_conf: 0.6
    min_num_hits: 0
    max_wo_hits: 150
    max_track_gallery_size: 50
    CAMEL:
      _target_: cameltrack.CAMEL
      sim_threshold: 0.1
      use_computed_sim_threshold: false
      gaffe:
        _target_: cameltrack.architecture.GAFFE
        emb_dim: 1024
        n_heads: 8
        n_layers: 4
        dim_feedforward: 2048
        checkpoint_path: null
      temporal_encoders:
        app_encoder:
          _target_: cameltrack.architecture.TemporalEncoder
          hidden_dim: 512
          n_heads: 8
          n_layers: 4
          dim_feedforward: 1024
          checkpoint_path: null
          det_tokenizer:
            _target_: cameltrack.architecture.PartsEmbeddingsLinProj
            use_parts: true
        kp_encoder:
          _target_: cameltrack.architecture.TemporalEncoder
          hidden_dim: 128
          n_heads: 8
          n_layers: 4
          dim_feedforward: 256
          checkpoint_path: null
          det_tokenizer:
            _target_: cameltrack.architecture.KeypointsLinProj
            use_conf: false
        bbox_encoder:
          _target_: cameltrack.architecture.TemporalEncoder
          hidden_dim: 64
          n_heads: 8
          n_layers: 4
          dim_feedforward: 128
          checkpoint_path: null
          det_tokenizer:
            _target_: cameltrack.architecture.BBoxLinProj
            use_conf: true
      optimizer:
        init_lr: 0.0001
        weight_decay: 0.0001
    train_cfg:
      use_wandb: ${use_wandb}
      use_rich: ${use_rich}
      evaluate_only: false
      model_selection_criteria: last
      pl_trainer:
        max_epochs: 2
        precision: 32
        gradient_clip_val: 0
        accumulate_grad_batches: 1
        enable_progress_bar: true
        enable_model_summary: false
        profiler: null
        num_sanity_val_steps: 0
        log_every_n_steps: 50
        check_val_every_n_epochs: 1
        val_check_interval: null
        fast_dev_run: false
    datamodule_cfg:
      _target_: cameltrack.train.CAMELDataModule
      batch_transforms:
        train:
          _target_: cameltrack.train.transforms.Compose
          transforms:
          - _target_: cameltrack.train.transforms.AppEmbNoise
            alpha: 0.4
          - _target_: cameltrack.train.transforms.KeypointsShake
            alpha: 0.05
          - _target_: cameltrack.train.transforms.BBoxShake
            alpha: 0.05
      tracklet_transforms:
        train:
          _target_: cameltrack.train.transforms.Compose
          transforms:
          - _target_: cameltrack.train.transforms.MaxNumObs
            max_num_obs: 150
          - _target_: cameltrack.train.transforms.DropoutFeatures
            p_drop_app: 0.4
            p_drop_bbox: 0.1
            p_drop_kps: 0.1
          - _target_: cameltrack.train.transforms.ProbabilisticTransform
            probs:
            - 0.4
            - 0.4
            - 0.1
            transforms:
            - _target_: cameltrack.train.transforms.SwapSporadic
              p_swap: 0.2
              sigma: 50
              method: gaussian
            - _target_: cameltrack.train.transforms.DropoutSporadic
              p_drop: 0.2
              sigma: 50
              method: gaussian
            - _target_: cameltrack.train.transforms.SwapOccluded
              p_swap: 0.5
              min_iou: 0.5
      sampler: simple
      sampler_args:
        fill_samples: true
      multi_dataset_training: false
      num_videos: null
      num_workers: ${num_cores}
      max_length: 50
      batch_size: 8
      num_samples: 32
      samples_per_video: 100
      train_add_val: false
      dataset_splits:
      - train
      - val
      name: camel
      path: ${dataset.dataset_path}/states/train_camel
      tracker_states:
        train: ${dataset.dataset_path}/states/train.pklz
        val: ${dataset.dataset_path}/states/val.pklz
      dataset_transforms:
      - add_detections
      - add_last_obs_counter
      - add_occlusions
      - add_dim_image
    _recursive_: false
pipeline:
- bbox_detector
- pose_estimator
- reid
- track
num_cores: 4
experiment_name: CAMELTrack
print_config: false
use_wandb: false
data_dir: ${project_dir}/data
model_dir: ${project_dir}/pretrained_models
state:
  load_file: null
  save_file: ${project_dir}/states/${experiment_name}-${dataset.eval_set}.pklz
  load_from_public_dets: false
  load_from_groundtruth: false
test_tracking: true
eval_tracking: true
use_rich: true
project_dir: ${hydra:runtime.cwd}
